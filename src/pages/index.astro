---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const universes = (await getCollection('universes')).sort((a, b) => a.data.order - b.data.order);

function slug(id: string) {
  return id.replace(/\.md$/, '');
}
---
<BaseLayout title="M.P. Tayle — Sci-Fi & Fantasy Author">
  <!-- Hero -->
  <section class="hero">
    <div class="container">
      <h1 class="hero__tagline">One Author, Two Genres.</h1>
      <p class="hero__prompt">Choose a universe to explore.</p>
    </div>
  </section>

  <!-- Universe Cards -->
  <section class="section">
    <div class="container">
      <div class="universe-grid">
        {universes.map((universe) => (
          <a
            href={`/universe/${slug(universe.id)}`}
            class="universe-card"
            style={`
              --card-glow: ${universe.data.accentGlow};
              ${universe.data.cardImage
                ? `background-image: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.1) 100%), url(${universe.data.cardImage});`
                : `background: ${universe.data.cardGradient};`
              }
              background-size: cover;
              background-position: center;
            `}
          >
            <span class="universe-card__genre">{universe.data.genre}</span>
            <h2 class="universe-card__title">{universe.data.name}</h2>
            <p class="universe-card__tagline">{universe.data.tagline}</p>
          </a>
        ))}
        <div
          class="universe-card universe-card--placeholder"
          style="--card-glow: rgba(120, 80, 160, 0.3); background: linear-gradient(135deg, #1a0e1e 0%, #2a1530 40%, #3d1f4a 70%, #2e1a20 100%);"
        >
          <span class="universe-card__genre">Dark Cozy Fantasy — Coming Soon</span>
          <h2 class="universe-card__title">Mysthaven</h2>
          <p class="universe-card__tagline">A new world is taking shape. Stay tuned.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- About -->
  <section class="about-section">
    <div class="container">
      <h2>Carefully-crafted, character-driven stories.</h2>
      <p>
        Whether it's the far reaches of space or the ancient kingdoms of a fantasy world,
        every story I write is built on the same foundation: characters you'll care about,
        choices that matter, and worlds you won't want to leave.
      </p>
    </div>
  </section>

  <!-- Newsletter -->
  <section class="newsletter" id="newsletter">
    <div class="container">
      <h2>Stay in the Loop</h2>
      <p>Join my newsletter for updates on new releases, bonus content, and behind-the-scenes peeks. When you join I'll send you a free copy of my Winds of Taramore short story "The Playwright!" Right to your email.</p>
      <div id="mlb2-37182211" class="ml-form-embedContainer ml-subscribe-form ml-subscribe-form-37182211">
        <div class="ml-form-embedWrapper embedForm">
          <div class="ml-form-embedBody ml-form-embedBodyHorizontal row-form">
            <form class="ml-block-form" action="https://assets.mailerlite.com/jsonp/2110846/forms/179504216725784452/subscribe" method="post" target="_blank">
              <div class="ml-form-formContent">
                <div class="ml-form-fieldRow">
                  <input type="email" class="form-control" name="fields[email]" placeholder="your@email.com" autocomplete="email" required />
                </div>
                <div class="ml-form-fieldRow ml-button-horizontal">
                  <button type="submit" class="primary">Subscribe</button>
                  <button disabled style="display: none;" type="button" class="loading">
                    <div class="ml-form-embedSubmitLoad"></div>
                    <span class="sr-only">Loading...</span>
                  </button>
                </div>
              </div>
              <div class="ml-form-recaptcha ml-validate-required">
                <div class="g-recaptcha" data-sitekey="6Lf1KHQUAAAAAFNKEX1hdSWCS3mRMv4FlFaNslaD"></div>
              </div>
              <input type="hidden" name="ml-submit" value="1">
              <input type="hidden" name="anticsrf" value="true">
            </form>
          </div>
          <div class="ml-form-successBody row-success" style="display: none">
            <div class="ml-form-successContent">
              <h4>Thank you!</h4>
              <p>Welcome to worlds full of adventure and fun.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <style>
    .universe-card::before {
      box-shadow: inset 0 0 60px var(--card-glow), 0 0 30px var(--card-glow);
    }
  </style>

  <script is:inline src="https://www.google.com/recaptcha/api.js"></script>
  <script is:inline src="https://groot.mailerlite.com/js/w/webforms.min.js?v95037e5bac78f29ed026832ca21a7c7b"></script>
  <script is:inline>
    function ml_webform_success_37182211() {
      var $ = ml_jQuery || jQuery;
      $('.ml-subscribe-form-37182211 .row-success').show();
      $('.ml-subscribe-form-37182211 .row-form').hide();
    }
    fetch("https://assets.mailerlite.com/jsonp/2110846/forms/179504216725784452/takel");
  </script>
</BaseLayout>
