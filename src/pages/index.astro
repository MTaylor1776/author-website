---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const universes = (await getCollection('universes')).sort((a, b) => a.data.order - b.data.order);

function slug(id: string) {
  return id.replace(/\.md$/, '');
}
---
<BaseLayout title="M.P. Tayle â€” Sci-Fi & Fantasy Author">
  <!-- Hero -->
  <section class="hero">
    <div class="container">
      <h1 class="hero__tagline">One Author, Two Genres.</h1>
      <p class="hero__prompt">Choose a universe to explore.</p>
    </div>
  </section>

  <!-- Universe Cards -->
  <section class="section">
    <div class="container">
      <div class="universe-grid">
        {universes.map((universe) => {
          const cardStyle = `
            --card-glow: ${universe.data.accentGlow};
            ${universe.data.cardImage
              ? `background-image: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.1) 100%), url(${universe.data.cardImage});`
              : `background: ${universe.data.cardGradient};`
            }
            background-size: cover;
            background-position: center;
          `;
          return universe.data.comingSoon ? (
            <div class="universe-card universe-card--placeholder" style={cardStyle}>
              <span class="universe-card__genre">{universe.data.genre}</span>
              <h2 class="universe-card__title">{universe.data.name}</h2>
              <p class="universe-card__tagline">{universe.data.tagline}</p>
              <span class="universe-card__coming-soon">Coming 2026!</span>
            </div>
          ) : (
            <a href={`/universe/${slug(universe.id)}`} class="universe-card" style={cardStyle}>
              <span class="universe-card__genre">{universe.data.genre}</span>
              <h2 class="universe-card__title">{universe.data.name}</h2>
              <p class="universe-card__tagline">{universe.data.tagline}</p>
            </a>
          );
        })}
      </div>
    </div>
  </section>

  <!-- About -->
  <section class="about-section">
    <div class="container">
      <h2>Carefully-crafted, character-driven stories.</h2>
      <p>
        Whether it's the far reaches of space or the ancient kingdoms of a fantasy world,
        every story I write is built on the same foundation: characters you'll care about,
        choices that matter, and worlds you won't want to leave.
      </p>
    </div>
  </section>

  <!-- Newsletter -->
  <section class="newsletter" id="newsletter">
    <div class="container">
      <h2>Stay in the Loop</h2>
      <p>Join my newsletter for updates on new releases, bonus content, and behind-the-scenes peeks. When you join I'll send you a free copy of my Winds of Taramore short story "The Playwright!" Right to your email.</p>
      <div class="ml-embedded" data-form="WE9oBU"></div>
    </div>
  </section>

  <style>
    .universe-card::before {
      box-shadow: inset 0 0 60px var(--card-glow), 0 0 30px var(--card-glow);
    }
  </style>

</BaseLayout>
